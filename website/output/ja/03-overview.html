<!DOCTYPE html>
<html><head><title>OSの全体像 - <undefined></undefined></title><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="stylesheet" href="/styles.css"><meta name="generator" content="Docship (https://github.com/nuta/docship)"></head><body class="mx-auto max-w-3xl w-full py-8 px-4"><header><h1 class="text-center mb-8 text-xl font-bold"><undefined></undefined> - OSの全体像</h1><div class="mb-8 container mx-auto flex justify-center"><ol class="w-full my-0 sm:w-fit grid grid-rows-[repeat(9,auto)] grid-flow-col gap-x-4" start="0"><li class="my-1"><a href="/ja/index" class="">はじめに</a></li><li class="my-1"><a href="/ja/01-setting-up-development-environment" class="">開発環境</a></li><li class="my-1"><a href="/ja/02-assembly" class="">RISC-V入門</a></li><li class="my-1"><a href="/ja/03-overview" class="font-bold">OSの全体像</a></li><li class="my-1"><a href="/ja/04-boot" class="">ブート</a></li><li class="my-1"><a href="/ja/05-hello-world" class="">Hello World!</a></li><li class="my-1"><a href="/ja/06-libc" class="">C標準ライブラリ</a></li><li class="my-1"><a href="/ja/07-kernel-panic" class="">カーネルパニック</a></li><li class="my-1"><a href="/ja/08-exception" class="">例外処理</a></li><li class="my-1"><a href="/ja/09-memory-allocation" class="">メモリ割り当て</a></li><li class="my-1"><a href="/ja/10-process" class="">プロセス</a></li><li class="my-1"><a href="/ja/11-page-table" class="">ページテーブル</a></li><li class="my-1"><a href="/ja/12-application" class="">アプリケーション</a></li><li class="my-1"><a href="/ja/13-user-mode" class="">ユーザーモード</a></li><li class="my-1"><a href="/ja/14-system-call" class="">システムコール</a></li><li class="my-1"><a href="/ja/15-virtio-blk" class="">ディスク読み書き</a></li><li class="my-1"><a href="/ja/16-file-system" class="">ファイルシステム</a></li><li class="my-1"><a href="/ja/17-conclusion" class="">おわりに</a></li></ol></div></header><main><p>OSを作り始める前に、どんな機能を作るのか、どのようなソースコードの構成になるのかをざっくりと把握しておきましょう。</p>
<h2 id="本書で実装する機能"><a class="anchor" href="#本書で実装する機能">本書で実装する機能</a></h2>
<p>本書で作るOSは、大きく分けて次の機能を持ちます。</p>
<ul>
<li><strong>マルチタスク</strong>: プロセスの切り替えを行い、複数のプログラムが同時に動作している (ように見せかける) 機能</li>
<li><strong>例外ハンドラ</strong>: 実行時エラーなどのCPUがOSの介入を必要とするイベントを処理する機能</li>
<li><strong>ページング</strong>: 各プロセスごとの独立したメモリ空間を実現</li>
<li><strong>システムコール</strong>: アプリケーションからOSの機能を呼び出す機能</li>
<li><strong>デバイスドライバ</strong>: ディスクの読み書きなど、ハードウェアを操作する機能</li>
<li><strong>ファイルシステム</strong>: ディスク上のファイルを管理する機能</li>
<li><strong>コマンドラインシェル</strong>: 利用者がコマンドを入力してOSの機能を呼び出せる機能</li>
</ul>
<h2 id="本書で実装しない機能"><a class="anchor" href="#本書で実装しない機能">本書で実装しない機能</a></h2>
<p>逆に何が欠けているのかというと、主に次のような主要機能が省かれています。</p>
<ul>
<li><strong>割り込み処理</strong>: 「デバイスに新しいデータがないか定期的にチェックする」方式 (ポーリング) で実装されています。</li>
<li><strong>タイマー処理</strong>: プリエンプティブマルチタスクは実装されません。各プロセスが自発的にCPUを譲る、協調的マルチタスクで実装されています。</li>
<li><strong>プロセス間通信</strong>: プロセス間でデータをやり取りする機能は実装されません。</li>
<li><strong>マルチプロセッサ対応</strong>: シングルプロセッサのみ対応です。</li>
</ul>
<p>もちろん、これらの機能は後から実装可能です。本書の実装を済ませた後に、<a href="https://github.com/nuta/microkernel-book">HinaOS</a>などを参考にしながら実装してみると良いでしょう。</p>
<h2 id="ソースコードの構成"><a class="anchor" href="#ソースコードの構成">ソースコードの構成</a></h2>
<p>ゼロからゆっくり作っていきますが、最終的には次のようなファイル構成になります。</p>
<pre><code>├── disk/     - ファイルシステムの中身
├── common.c  - カーネル・ユーザー共通ライブラリ: printf関数やmemset関数など
├── common.h  - カーネル・ユーザー共通ライブラリ: 各種構造体・定数などの定義
├── kernel.c  - カーネル: プロセス管理、システムコール、デバイスドライバ、ファイルシステム
├── kernel.h  - カーネル: 各種構造体・定数などの定義
├── kernel.ld - カーネル: リンカスクリプト (メモリレイアウトの定義)
├── shell.c   - コマンドラインシェル
├── user.c    - ユーザー用ライブラリ: システムコールの呼び出し関数など
├── user.h    - ユーザー用ライブラリ: 各種構造体・定数などの定義
├── user.ld   - ユーザー: リンカスクリプト (メモリレイアウトの定義)
└── run.sh    - ビルドスクリプト
</code></pre>
<blockquote class="callout callout-tip">
<p>本書中では「ユーザーランド」を略して「ユーザー」と表記していることがあります。ざっくり「アプリケーション側」という意味で捉えると分かりやすいでしょう。</p>
</blockquote></main><footer class="mt-8 border-t border-gray-200 py-4"><div class="container mx-auto px-4 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 text-lg"><a href="/ja/04-boot">ブート ⏩</a><a href="/ja/02-assembly" class="sm:-order-1">⏪ RISC-V入門</a></div></footer></body></html>