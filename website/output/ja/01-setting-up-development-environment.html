<!DOCTYPE html>
<html><head><title>開発環境 - 1000行で作るOS</title><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="stylesheet" href="/styles.css"><meta name="generator" content="Docship (https://github.com/nuta/docship)"></head><body class="mx-auto max-w-3xl w-full py-8 px-4"><header><h1 class="text-center mb-8 text-xl font-bold">1000行で作るOS - 開発環境</h1><div class="mb-8 container mx-auto flex justify-center"><ol class="w-full my-0 sm:w-fit grid grid-rows-[repeat(9,auto)] grid-flow-col gap-x-4" start="0"><li class="my-1"><a href="/ja/index" class="">はじめに</a></li><li class="my-1"><a href="/ja/01-setting-up-development-environment" class="font-bold">開発環境</a></li><li class="my-1"><a href="/ja/02-assembly" class="">RISC-V入門</a></li><li class="my-1"><a href="/ja/03-overview" class="">OSの全体像</a></li><li class="my-1"><a href="/ja/04-boot" class="">ブート</a></li><li class="my-1"><a href="/ja/05-hello-world" class="">Hello World!</a></li><li class="my-1"><a href="/ja/06-libc" class="">C標準ライブラリ</a></li><li class="my-1"><a href="/ja/07-kernel-panic" class="">カーネルパニック</a></li><li class="my-1"><a href="/ja/08-exception" class="">例外処理</a></li><li class="my-1"><a href="/ja/09-memory-allocation" class="">メモリ割り当て</a></li><li class="my-1"><a href="/ja/10-process" class="">プロセス</a></li><li class="my-1"><a href="/ja/11-page-table" class="">ページテーブル</a></li><li class="my-1"><a href="/ja/12-application" class="">アプリケーション</a></li><li class="my-1"><a href="/ja/13-user-mode" class="">ユーザーモード</a></li><li class="my-1"><a href="/ja/14-system-call" class="">システムコール</a></li><li class="my-1"><a href="/ja/15-virtio-blk" class="">ディスク読み書き</a></li><li class="my-1"><a href="/ja/16-file-system" class="">ファイルシステム</a></li><li class="my-1"><a href="/ja/17-conclusion" class="">おわりに</a></li></ol></div></header><main><p>本書では、macOSとUbuntuといったUNIX系OSを想定しています。Windowsをお使いの場合は、Windows Subsystem for Linux (WSL2) をインストールしたのち、Ubuntuの手順に従ってください。</p>
<h2 id="ソフトウェアのインストール"><a class="anchor" href="#ソフトウェアのインストール">ソフトウェアのインストール</a></h2>
<h3 id="macos"><a class="anchor" href="#macos">macOS</a></h3>
<p><a href="https://brew.sh/index_ja">Homebrew</a> をインストールしたのち、次のコマンドで必要なパッケージをインストールします。</p>
<pre><code>brew install llvm qemu
</code></pre>
<h3 id="ubuntu"><a class="anchor" href="#ubuntu">Ubuntu</a></h3>
<p>次のコマンドで必要なパッケージをインストールします。他のLinuxディストリビューションをお使いの場合は、適宜読み替えてください。</p>
<pre><code>sudo apt update &#x26;&#x26; sudo apt install -y clang llvm lld qemu-system-riscv32 curl
</code></pre>
<p>加えてOpenSBI (PCでいうBIOS/UEFI) を作業用ディレクトリにダウンロードしておきます。</p>
<pre><code>cd &#x3C;開発用ディレクトリ>
curl -LO https://github.com/qemu/qemu/raw/v8.0.4/pc-bios/opensbi-riscv32-generic-fw_dynamic.bin
</code></pre>
<blockquote class="callout callout-warning">
<p>QEMUを実行する際に、 <code>opensbi-riscv32-generic-fw_dynamic.bin</code> がカレントディレクトリにある必要があります。別の場所にある場合、次の「ファイルが見当たらない」エラーが出ます。</p>
<pre><code>qemu-system-riscv32: Unable to load the RISC-V firmware "opensbi-riscv32-generic-fw_dynamic.bin"
</code></pre>
</blockquote>
<h3 id="その他のos"><a class="anchor" href="#その他のos">その他のOS</a></h3>
<p>どうしても他のOSを使いたい場合は、次のコマンドを頑張ってインストールしてください。</p>
<ul>
<li><code>bash</code>: コマンドラインシェル。UNIX系OSには基本的に最初から入っている。</li>
<li><code>tar</code>: tarアーカイブ操作ツール。UNIX系OSには基本的に最初から入っている。GNU版の<code>tar</code>がおすすめ。</li>
<li><code>clang</code>: Cコンパイラ。32ビットRISC-V CPUに対応していること (下記参照)。</li>
<li><code>llvm-objcopy</code>: オブジェクトファイル編集ツール。よくLLVMパッケージに入っている。(GNU binutilsの<code>objcopy</code>でも代用可)。</li>
<li><code>llvm-objdump</code>: 逆アセンブラ。<code>llvm-objcopy</code>と同様。</li>
<li><code>llvm-readelf</code>: ELFファイル解析ツール。<code>llvm-objcopy</code>と同様。</li>
<li><code>qemu-system-riscv32</code>: 32ビットRISC-V CPUのエミュレータ。QEMUパッケージに入っている。</li>
</ul>
<blockquote class="callout callout-tip">
<p>お使いのclangが32ビットRISC-Vに対応しているかは、次のコマンドで確認できます。</p>
<pre><code>$ clang -print-targets | grep riscv32
    riscv32     - 32-bit RISC-V
</code></pre>
<p><code>riscv32</code>が表示されればOKです。表示されない代表例としては、macOS標準のclangがあります。上記の手順では、Homebrewの全部入りclang (<code>llvm</code>パッケージ) を代わりにインストールしています。</p>
</blockquote>
<h2 id="gitリポジトリの用意-任意"><a class="anchor" href="#gitリポジトリの用意-任意">Gitリポジトリの用意 (任意)</a></h2>
<p>もしGitリポジトリ下で作っていく場合は、次の<code>.gitignore</code>をあらかじめ用意しておくと便利です。</p>
<pre><div class="code-block-title">.gitignore</div><code class="language-plain">/disk/*
!/disk/.gitkeep
*.map
*.tar
*.o
*.elf
*.bin
*.log
*.pcap
</code></pre></main><footer class="mt-8 border-t border-gray-200 py-4"><div class="container mx-auto px-4 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 text-lg"><a href="/ja/02-assembly">RISC-V入門 ⏩</a><a href="/ja/index" class="sm:-order-1">⏪ はじめに</a></div></footer></body></html>